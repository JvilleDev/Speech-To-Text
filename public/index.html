<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voz a Texto</title>
  <link rel="stylesheet" href="/static/FontAwesome/css/all.min.css"/>
  <link rel="stylesheet" href="/static/css/bootstrap.min.css">
  <link href="/static/fonts/Poppins/poppins.css" rel="stylesheet">
  <script src="/static/js/alert.js"></script>
  <script src="/static/js/jquery-3.7.1.min.js"></script>
  <script src="/static/js/bootstrap.js"></script>
  <script src="/static/js/popper.min.js"></script>
  <script src="script.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <link rel="stylesheet" href="/static/css/alerts.css">
  <style>
    body {
      overflow-y: scroll;
      font-family: 'Poppins', sans-serif !important;
    }

    thead {
      margin-right: 8px;
    }

    table tr td {
      width: 33.33%;
    }

    tr {
      width: 100%;
      display: inline-flex;
    }

    thead tr th {
      width: 33.33%;
      display: inline-block;
    }

    #newText {
      color: #007bff;
    }

    .nav-link {
      text-align: center;
      font-weight: bold;
      transition: color 0.2s ease-in-out, font-weight 0.2s ease-in-out, background-color 0.2s ease-in-out;
    }

    .nav-link:hover {
      background-color: #007bff !important;
      color: #fff !important;
    }

    .menu {
      font-weight: 600 !important;
      border-radius: 0.5rem;
      margin-right: 0.5rem;
      transition: color 0.2s ease-in-out, font-weight 0.2s ease-in-out, background-color 0.2s ease-in-out !important;
    }

    .menu.active,
    .menu:hover {
      background-color: #007bff;
      color: rgb(255, 255, 255) !important;
    }
    .navbar{
      padding: 1rem !important;
      justify-content: center !important;
    }

    *::-webkit-scrollbar {
      width: 8px;
    }

    *::-webkit-scrollbar-track {
      background-color: transparent;
    }

    *::-webkit-scrollbar-thumb {
      background-color: #333;
      border-radius: 1rem;
    }
    .preloader {
      position: fixed;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 2s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
    body.loaded .preloader {
      display: none;
    }

    body.loaded .content {
      opacity: 1;
      transition: opacity 0.5s;
    }
    .nav-link{
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="preloader">
    <div class="loader"></div>
  </div>
  <div id="alert-container"></div>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="/">
      <img src="favicon.ico" alt="Logo" width="30" height="30" class="d-inline-block align-top">
      Voz a Texto
    </a>
        <div class="navbar-collapse" id="navbarNav">
      <ul class="navbar-nav" >
        <li class="nav-item">
          <a class="nav-link menu active" href="/" target="_blank">Transcripción</a>
        </li>
        <li class="nav-item">
          <a class="nav-link menu" href="/transcripcion" target="_blank">Visualizador</a>
        </li>
        <li class="nav-item">
          <a id="link" class="nav-link menu" href="/programa" target="_blank">Insertar en programa</a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="container" style="margin: 1rem;">
    <input id="alertInput" class="form-control" type="text" placeholder="Escribe aquí para enviar una alerta">
</div>

  <div>
    <ul class="nav nav-tabs" id="customTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="nav-link active" id="transcribe-tab" data-bs-toggle="tab" href="#transcriptionTab" role="tab" aria-controls="transcriptionTab" aria-selected="true">Transcribir</a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" id="replace-tab" data-bs-toggle="tab" href="#reemplazar" role="tab" aria-controls="reemplazar" aria-selected="false">Reemplazar</a>
      </li>
    </ul>
    
    <div class="tab-content m-3">
      <div class="tab-pane fade show active" id="transcriptionTab" role="tabpanel" aria-labelledby="transcribe-tab">
        <div class="d-flex justify-content-center align-items-center mb-3">
          <button id="record-button" class="btn btn-primary">
            <i class="fas fa-microphone"></i> Iniciar
          </button>
        </div>
        
        <div id="transcription" class="border rounded p-4 bg-light mb-3" style="max-height: 50vh; border-radius: 0.5rem; scroll-behavior: smooth; font-size: 2rem;overflow-y: auto;overflow-x: hidden;">
        </div>
      </div>
    
      <div class="tab-pane fade" id="reemplazar" role="tabpanel" aria-labelledby="replace-tab">
        <button id="agregarBtn" class="btn btn-primary mb-3" onclick="toggleFormulario()">Añadir</button>
        <div id="agregarForm" class="mt-3" style="display: none;">
          <form id="nuevoReemplazoForm">
            <input type="text" id="palabra" name="palabra" required class="form-control" placeholder="CAMBIAR...">
            <input type="text" id="replace" name="reemplazar" required class="form-control" placeholder="POR...">
            <button type="submit" class="btn btn-success">Guardar</button>
          </form>
        </div>
        <div class="table-container mb-3">
          <table class="table table-bordered">
            <thead style="margin-right: 8px;">
              <tr>
                <th>Palabra</th>
                <th>Reemplazar por</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="reemplazosBody" style="max-height: 400px; overflow-y: auto; display: block;">
            </tbody>
          </table>
        </div>
            
  <script>
    const socket = io();
    document.addEventListener("DOMContentLoaded", function () {
      let preloader = document.querySelector(".preloader");
      preloader.style.display = "flex";
      setTimeout(function () {
        preloader.style.display = "none";
      }, 300);
    });
    let enlace = document.getElementById('link');
    enlace.addEventListener('click', function(event) {
        event.preventDefault();
        let host = window.location.hostname;
        let enlaceURL = 'http://' + host+':3000' + enlace.getAttribute('href');
        let input = document.createElement('input');
        input.value = enlaceURL;
        document.body.appendChild(input);
        input.select();
        document.execCommand('copy');
        document.body.removeChild(input);
        showAlert('Enlace copiado. Agrégalo a vMix u OBS para ver la transcripción en tiempo real', 'info');
    });
    const alertInput = document.getElementById('alertInput');
        if (alertInput) {
            alertInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    const inputValue = alertInput.value;
                    socket.emit('newAlert', inputValue);
                    alertInput.value = '';
                    showAlert('<strong>Alerta:</strong> "' + inputValue + '" enviada exitosamente', 'info');
                }
            });
        }

  </script>
</body>

</html>